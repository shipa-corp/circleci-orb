description: >
  Create app in shipa.
parameters:
  appname:
    default: SHIPA_APP_NAME
    description: Your shipa app name
    type: env_var_name
  platform:
    default: SHIPA_APP_PLATFORM
    description: App platform (https://learn.shipa.io/docs/platforms)
    type: env_var_name
  team:
    default: SHIPA_TEAM
    description: Shipa team name
    type: env_var_name
  pool:
    default: SHIPA_POOL
    description: Shipa pool name
    type: env_var_name
  user:
    default: SHIPA_USER
    description: Your shipa user (email)
    type: env_var_name
  password:
    default: SHIPA_PASSWORD
    description: Your shipa password
    type: env_var_name
  server:
    default: SHIPA_SERVER
    description: Your shipa server URL (for example http://shipa-ci-integration.org:8080)
    type: env_var_name
  ca:
    default: SHIPA_CA
    description: Your shipa CA certificate (base64 encoded)
    type: env_var_name
steps:
  - run:
      name: Deploy app to shipa cluster
      command: |
        if [[ ${<< parameters.ca >>} == "" ]]; then
          shipa-ci \
          --server=${<< parameters.server >>} \
          --email=${<< parameters.user >>} \
          --password=${<< parameters.password >>} \
          app create ${<< parameters.appname >>} ${<< parameters.platform >>} \
          --team=${<< parameters.team >>} \
          --pool=${<< parameters.pool >>}
        else
          shipa-ci \
          --server=${<< parameters.server >>} \
          --email=${<< parameters.user >>} \
          --password=${<< parameters.password >>} \
          --ca=$(echo "${<< parameters.ca >>}" | base64 -d) \
          app create ${<< parameters.appname >>} ${<< parameters.platform >>} \
          --team=${<< parameters.team >>} \
          --pool=${<< parameters.pool >>}
        fi
