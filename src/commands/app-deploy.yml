description: >
  Deploys app to shipa cluster.
parameters:
  appname:
    default: $SHIPA_APP_NAME
    description: Your shipa app name
    type: string
  token:
    default: $SHIPA_TOKEN
    description: Your shipa token
    type: string
  server:
    default: $SHIPA_SERVER
    description: Your shipa server URL (for example http://shipa-ci-integration.org:8080)
    type: string
  ca:
    default: $SHIPA_CA
    description: Your shipa CA certificate
    type: string
steps:
  - run:
      name: Deploy app to shipa cluster
      command: |
        if [[ $SHIPA_CA == "" ]]; then
          shipa-ci --server=$SHIPA_SERVER --token=$SHIPA_TOKEN app deploy --app=$SHIPA_APP_NAME
        else
          shipa-ci --server=$SHIPA_SERVER --token=$SHIPA_TOKEN --ca="$SHIPA_CA" app deploy --app=$SHIPA_APP_NAME
        fi
